/*
 * Swipe 2.0
 *
 * Brad Birdsall
 * Copyright 2013, MIT License
 *
*/
function Swipe(t,n){"use strict";function e(){w=g.children,x=w.length,2>w.length&&(n.continuous=!1),m.transitions&&n.continuous&&3>w.length&&(g.appendChild(w[0].cloneNode(!0)),g.appendChild(g.children[1].cloneNode(!0)),w=g.children),p=Array(w.length),E=t.getBoundingClientRect().width||t.offsetWidth,g.style.width=w.length*E+"px";for(var e=w.length;e--;){var i=w[e];i.style.width=E+"px",i.setAttribute("data-index",e),m.transitions&&(i.style.left=e*-E+"px",a(e,b>e?-E:e>b?E:0,0))}n.continuous&&m.transitions&&(a(s(b-1),-E,0),a(s(b+1),E,0)),m.transitions||(g.style.left=b*-E+"px"),t.style.visibility="visible"}function i(){n.continuous?r(b-1):b&&r(b-1),n.events&&n.events.emit("prev",v)}function o(){n.continuous?r(b+1):w.length-1>b&&r(b+1)}function s(t){return(w.length+t%w.length)%w.length}function r(t,e){var i=-1;if("number"==typeof t)i=t;else if("string"==typeof t)for(var o=0;w.length>o;++o){var r=w[o];if(r.id===t){i=o;break}}else{if(!(t instanceof Element))throw"Invalid target type.";for(var o=0;w.length>o;++o){var r=w[o];if(r.id==id){i=o;break}}}if(-1==i||i==b)return!1;if(m.transitions){var u=Math.abs(i-b)/(i-b);if(n.continuous){var c=u;u=-p[s(b)]/E,u!==c&&(b=-u*w.length+b)}for(var l=Math.abs(i-b)-1;l--;)a(s((i>b?i:b)-l-1),E*u,0);b=s(toIndexndex),a(b,E*u,e||y),a(i,0,e||y),n.continuous&&a(s(b-u),-(E*u),0)}else b=s(i),d(b*-E,i*-E,e||y);b=i,h(n.callback&&n.callback(b,w[b])),n.events&&n.events.emit("slide",v,b,w[b])}function a(t,n,e){u(t,n,e),p[t]=n}function u(t,n,e){var i=w[t],o=i&&i.style;o&&(o.webkitTransitionDuration=o.MozTransitionDuration=o.msTransitionDuration=o.OTransitionDuration=o.transitionDuration=e+"ms",o.webkitTransform="translate("+n+"px,0)"+"translateZ(0)",o.msTransform=o.MozTransform=o.OTransform="translateX("+n+"px)")}function d(t,e,i){if(!i)return g.style.left=e+"px",void 0;var o=+new Date,s=setInterval(function(){var r=+new Date-o;return r>i?(g.style.left=e+"px",k&&c(),n.transitionEnd&&n.transitionEnd.call(event,b,w[b]),n.events&&n.events.emit("transitionEnd",v,b,w[b]),clearInterval(s),void 0):(g.style.left=(e-t)*(Math.floor(100*(r/i))/100)+t+"px",void 0)},4)}function c(){T=setTimeout(o,k),n.events&&n.events.emit("begin",v)}function l(){k=0,clearTimeout(T),n.events&&n.events.emit("stop",v)}var v=this,f=function(){},h=function(t){setTimeout(t||f,0)},m={addEventListener:!!window.addEventListener,touch:"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,transitions:function(t){var n=["transitionProperty","WebkitTransition","MozTransition","OTransition","msTransition"];for(var e in n)if(void 0!==t.style[n[e]])return!0;return!1}(document.createElement("swipe"))};if(t){var w,p,E,x,g=t.children[0];n=n||{};var b=parseInt(n.startSlide,10)||0,y=n.speed||300;n.continuous=void 0!==n.continuous?n.continuous:!0;var T,L,k=n.auto||0,D={},M={},z={handleEvent:function(t){switch(t.type){case"touchstart":this.start(t);break;case"touchmove":this.move(t);break;case"touchend":h(this.end(t));break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"otransitionend":case"transitionend":h(this.transitionEnd(t));break;case"resize":h(e.call())}n.stopPropagation&&t.stopPropagation()},start:function(t){var n=t.touches[0];D={x:n.pageX,y:n.pageY,time:+new Date},L=void 0,M={},g.addEventListener("touchmove",this,!1),g.addEventListener("touchend",this,!1)},move:function(t){if(!(t.touches.length>1||t.scale&&1!==t.scale)){n.disableScroll&&t.preventDefault();var e=t.touches[0];M={x:e.pageX-D.x,y:e.pageY-D.y},L===void 0&&(L=!!(L||Math.abs(M.x)<Math.abs(M.y))),L||(t.preventDefault(),l(),n.continuous?(u(s(b-1),M.x+p[s(b-1)],0),u(b,M.x+p[b],0),u(s(b+1),M.x+p[s(b+1)],0)):(M.x=M.x/(!b&&M.x>0||b==w.length-1&&0>M.x?Math.abs(M.x)/E+1:1),u(b-1,M.x+p[b-1],0),u(b,M.x+p[b],0),u(b+1,M.x+p[b+1],0)))}},end:function(){var t=+new Date-D.time,e=250>Number(t)&&Math.abs(M.x)>20||Math.abs(M.x)>E/2,i=!b&&M.x>0||b==w.length-1&&0>M.x;n.continuous&&(i=!1);var o=0>M.x;L||(e&&!i?(o?(n.continuous?(a(s(b-1),-E,0),a(s(b+2),E,0)):a(b-1,-E,0),a(b,p[b]-E,y),a(s(b+1),p[s(b+1)]-E,y),b=s(b+1)):(n.continuous?(a(s(b+1),E,0),a(s(b-2),-E,0)):a(b+1,E,0),a(b,p[b]+E,y),a(s(b-1),p[s(b-1)]+E,y),b=s(b-1)),n.callback&&n.callback(b,w[b])):n.continuous?(a(s(b-1),-E,y),a(b,0,y),a(s(b+1),E,y)):(a(b-1,-E,y),a(b,0,y),a(b+1,E,y))),g.removeEventListener("touchmove",z,!1),g.removeEventListener("touchend",z,!1)},transitionEnd:function(t){parseInt(t.target.getAttribute("data-index"),10)==b&&(k&&c(),n.transitionEnd&&n.transitionEnd.call(t,b,w[b]),n.events&&n.events.emit("transitionEnd",v,b,w[b]))}};return e(),k&&c(),m.addEventListener?(m.touch&&g.addEventListener("touchstart",z,!1),m.transitions&&(g.addEventListener("webkitTransitionEnd",z,!1),g.addEventListener("msTransitionEnd",z,!1),g.addEventListener("oTransitionEnd",z,!1),g.addEventListener("otransitionend",z,!1),g.addEventListener("transitionend",z,!1)),window.addEventListener("resize",z,!1)):window.onresize=function(){e()},{setup:e,slide:function(t,n){l(),r(t,n)},prev:function(){l(),i()},next:function(){l(),o()},getPos:function(){return b},getNumSlides:function(){return x},kill:function(){l(),g.style.width="auto",g.style.left=0;for(var t=w.length;t--;){var n=w[t];n.style.width="100%",n.style.left=0,m.transitions&&u(t,0,0)}m.addEventListener?(g.removeEventListener("touchstart",z,!1),g.removeEventListener("webkitTransitionEnd",z,!1),g.removeEventListener("msTransitionEnd",z,!1),g.removeEventListener("oTransitionEnd",z,!1),g.removeEventListener("otransitionend",z,!1),g.removeEventListener("transitionend",z,!1),window.removeEventListener("resize",z,!1)):window.onresize=null},slideCount:function(){return w.length}}}}(window.jQuery||window.Zepto)&&function(t){t.fn.Swipe=function(n){return this.each(function(){t(this).data("Swipe",new Swipe(t(this)[0],n))})}}(window.jQuery||window.Zepto);