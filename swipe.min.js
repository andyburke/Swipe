/*
 * Swipe 2.0
 *
 * Brad Birdsall
 * Copyright 2013, MIT License
 *
*/

function Swipe(t,e){"use strict";function n(){m=p.children,w=Array(m.length),E=t.getBoundingClientRect().width||t.offsetWidth,p.style.width=m.length*E+"px";for(var e=m.length;e--;){var n=m[e];n.style.width=E+"px",n.setAttribute("data-index",e),h.transitions&&(n.style.left=e*-E+"px",o(e,b>e?-E:e>b?E:0,0))}h.transitions||(p.style.left=b*-E+"px"),t.style.visibility="visible"}function i(){b?s(b-1):e.continuous&&s(m.length-1),e.events&&e.events.emit("prev",c)}function r(){m.length-1>b?s(b+1):e.continuous&&s(0),e.events&&e.events.emit("next",c)}function s(t,n){var i=-1;if("number"==typeof t)i=t;else if("string"==typeof t)for(var r=0;m.length>r;++r){var s=m[r];if(s.id===t){i=r;break}}else{if(!(t instanceof Element))throw"Invalid target type.";for(var r=0;m.length>r;++r){var s=m[r];if(s.id==id){i=r;break}}}if(-1==i||i==b)return!1;if(h.transitions){for(var a=Math.abs(b-i)-1,u=Math.abs(b-i)/(b-i);a--;)o((i>b?i:b)-a-1,E*u,0);o(b,E*u,n||x),o(i,0,n||x)}else d(b*-E,i*-E,n||x);return b=i,f(e.callback&&e.callback(b,m[b])),e.events&&e.events.emit("slide",c,b,m[b]),!0}function o(t,e,n){a(t,e,n),w[t]=e}function a(t,e,n){var i=m[t],r=i&&i.style;r&&(r.webkitTransitionDuration=r.MozTransitionDuration=r.msTransitionDuration=r.OTransitionDuration=r.transitionDuration=n+"ms",r.webkitTransform="translate("+e+"px,0)"+"translateZ(0)",r.msTransform=r.MozTransform=r.OTransform="translateX("+e+"px)")}function d(t,n,i){if(!i)return p.style.left=n+"px",void 0;var r=+new Date,s=setInterval(function(){var o=+new Date-r;return o>i?(p.style.left=n+"px",T&&u(),e.transitionEnd&&e.transitionEnd.call(event,b,m[b]),e.events&&e.events.emit("transitionEnd",c,b,m[b]),clearInterval(s),void 0):(p.style.left=(n-t)*(Math.floor(100*(o/i))/100)+t+"px",void 0)},4)}function u(){g=setTimeout(r,T),e.events&&e.events.emit("begin",c)}function v(){T=0,clearTimeout(g),e.events&&e.events.emit("stop",c)}var c=this,l=function(){},f=function(t){setTimeout(t||l,0)},h={addEventListener:!!window.addEventListener,touch:"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,transitions:function(t){var e=["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"];for(var n in e)if(void 0!==t.style[e[n]])return!0;return!1}(document.createElement("swipe"))};if(t){var m,w,E,p=t.children[0];e=e||{};var b=parseInt(e.startSlide,10)||0,x=e.speed||300;e.continuous=void 0!==e.continuous?e.continuous:!0;var g,y,T=e.auto||0,L={},k={},D={handleEvent:function(t){switch(t.type){case"touchstart":this.start(t);break;case"touchmove":this.move(t);break;case"touchend":f(this.end(t));break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"otransitionend":case"transitionend":f(this.transitionEnd(t));break;case"resize":f(n.call())}e.stopPropagation&&t.stopPropagation()},start:function(t){var e=t.touches[0];L={x:e.pageX,y:e.pageY,time:+new Date},y=void 0,k={},p.addEventListener("touchmove",this,!1),p.addEventListener("touchend",this,!1)},move:function(t){if(!(t.touches.length>1||t.scale&&1!==t.scale)){e.disableScroll&&t.preventDefault();var n=t.touches[0];k={x:n.pageX-L.x,y:n.pageY-L.y},y===void 0&&(y=!!(y||Math.abs(k.x)<Math.abs(k.y))),y||(t.preventDefault(),v(),k.x=k.x/(!b&&k.x>0||b==m.length-1&&0>k.x?Math.abs(k.x)/E+1:1),a(b-1,k.x+w[b-1],0),a(b,k.x+w[b],0),a(b+1,k.x+w[b+1],0))}},end:function(){var t=+new Date-L.time,n=250>Number(t)&&Math.abs(k.x)>20||Math.abs(k.x)>E/2,i=!b&&k.x>0||b==m.length-1&&0>k.x,r=0>k.x;y||(n&&!i?(r?(o(b-1,-E,0),o(b,w[b]-E,x),o(b+1,w[b+1]-E,x),b+=1):(o(b+1,E,0),o(b,w[b]+E,x),o(b-1,w[b-1]+E,x),b+=-1),e.callback&&e.callback(b,m[b]),e.events&&e.events.emit("slide",c,b,m[b])):(o(b-1,-E,x),o(b,0,x),o(b+1,E,x))),p.removeEventListener("touchmove",D,!1),p.removeEventListener("touchend",D,!1)},transitionEnd:function(t){parseInt(t.target.getAttribute("data-index"),10)==b&&(T&&u(),e.transitionEnd&&e.transitionEnd.call(t,b,m[b]),e.events&&e.events.emit("transitionEnd",c,b,m[b]))}};return n(),T&&u(),h.addEventListener?(h.touch&&p.addEventListener("touchstart",D,!1),h.transitions&&(p.addEventListener("webkitTransitionEnd",D,!1),p.addEventListener("msTransitionEnd",D,!1),p.addEventListener("oTransitionEnd",D,!1),p.addEventListener("otransitionend",D,!1),p.addEventListener("transitionend",D,!1)),window.addEventListener("resize",D,!1)):window.onresize=function(){n()},{setup:n,slide:function(t,e){v(),s(t,e)},prev:function(){v(),i()},next:function(){v(),r()},getPos:function(){return b},getNumSlides:function(){return m.length},kill:function(){v(),p.style.width="auto",p.style.left=0;for(var t=m.length;t--;){var e=m[t];e.style.width="100%",e.style.left=0,h.transitions&&a(t,0,0)}h.addEventListener?(p.removeEventListener("touchstart",D,!1),p.removeEventListener("webkitTransitionEnd",D,!1),p.removeEventListener("msTransitionEnd",D,!1),p.removeEventListener("oTransitionEnd",D,!1),p.removeEventListener("otransitionend",D,!1),p.removeEventListener("transitionend",D,!1),window.removeEventListener("resize",D,!1)):window.onresize=null}}}}(window.jQuery||window.Zepto)&&function(t){t.fn.Swipe=function(e){return this.each(function(){t(this).data("Swipe",new Swipe(t(this)[0],e))})}}(window.jQuery||window.Zepto);
