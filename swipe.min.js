/*
 * Swipe 2.0
 *
 * Brad Birdsall
 * Copyright 2013, MIT License
 *
*/

function Swipe(t,e){"use strict";function n(){m=p.children,w=Array(m.length),E=t.getBoundingClientRect().width||t.offsetWidth,p.style.width=m.length*E+"px";for(var e=m.length;e--;){var n=m[e];n.style.width=E+"px",n.setAttribute("data-index",e),h.transitions&&(n.style.left=e*-E+"px",o(e,y>e?-E:e>y?E:0,0))}h.transitions||(p.style.left=y*-E+"px"),t.style.visibility="visible"}function i(){y?s(y-1):e.continuous&&s(m.length-1),e.events&&e.events.emit("prev",c)}function r(){m.length-1>y?s(y+1):e.continuous&&s(0),e.events&&e.events.emit("next",c)}function s(t,n){var i=-1;if("number"==typeof t)i=t;else if("string"==typeof t)for(var r=0;m.length>r;++r){var s=m[r];if(s.id===t){i=r;break}}else{if(!(t instanceof Element))throw"Invalid target type.";for(var r=0;m.length>r;++r){var s=m[r];if(s.id==id){i=r;break}}}if(-1==i||i==y)return!1;if(h.transitions){for(var a=Math.abs(y-i)-1,v=Math.abs(y-i)/(y-i);a--;)o((i>y?i:y)-a-1,E*v,0);o(y,E*v,n||g),o(i,0,n||g)}else d(y*-E,i*-E,n||g);return y=i,f(e.callback&&e.callback(y,m[y])),e.events&&e.events.emit("slide",c,y,m[y]),!0}function o(t,e,n){a(t,e,n),w[t]=e}function a(t,e,n){var i=m[t],r=i&&i.style;r&&(r.webkitTransitionDuration=r.MozTransitionDuration=r.msTransitionDuration=r.OTransitionDuration=r.transitionDuration=n+"ms",r.webkitTransform="translate("+e+"px,0)"+"translateZ(0)",r.msTransform=r.MozTransform=r.OTransform="translateX("+e+"px)")}function d(t,n,i){if(!i)return p.style.left=n+"px",void 0;var r=+new Date,s=setInterval(function(){var o=+new Date-r;return o>i?(p.style.left=n+"px",T&&v(),e.transitionEnd&&e.transitionEnd.call(event,y,m[y]),e.events&&e.events.emit("transitionEnd",c,y,m[y]),clearInterval(s),void 0):(p.style.left=(n-t)*(Math.floor(100*(o/i))/100)+t+"px",void 0)},4)}function v(){b=setTimeout(r,T),e.events&&e.events.emit("begin",c)}function u(){T=0,clearTimeout(b),e.events&&e.events.emit("stop",c)}var c=this,l=function(){},f=function(t){setTimeout(t||l,0)},h={addEventListener:!!window.addEventListener,touch:"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,transitions:function(t){var e=["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"];for(var n in e)if(void 0!==t.style[e[n]])return!0;return!1}(document.createElement("swipe"))};if(t){var m,w,E,p=t.children[0];e=e||{};var b,x,y=parseInt(e.startSlide,10)||0,g=e.speed||300,T=e.auto||0,L={},k={},D={handleEvent:function(t){switch(t.type){case"touchstart":this.start(t);break;case"touchmove":this.move(t);break;case"touchend":f(this.end(t));break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"otransitionend":case"transitionend":f(this.transitionEnd(t));break;case"resize":f(n.call())}e.stopPropagation&&t.stopPropagation()},start:function(t){var e=t.touches[0];L={x:e.pageX,y:e.pageY,time:+new Date},x=void 0,k={},p.addEventListener("touchmove",this,!1),p.addEventListener("touchend",this,!1)},move:function(t){if(!(t.touches.length>1||t.scale&&1!==t.scale)){e.disableScroll&&t.preventDefault();var n=t.touches[0];k={x:n.pageX-L.x,y:n.pageY-L.y},x===void 0&&(x=!!(x||Math.abs(k.x)<Math.abs(k.y))),x||(t.preventDefault(),u(),k.x=k.x/(!y&&k.x>0||y==m.length-1&&0>k.x?Math.abs(k.x)/E+1:1),a(y-1,k.x+w[y-1],0),a(y,k.x+w[y],0),a(y+1,k.x+w[y+1],0))}},end:function(){var t=+new Date-L.time,n=250>Number(t)&&Math.abs(k.x)>20||Math.abs(k.x)>E/2,i=!y&&k.x>0||y==m.length-1&&0>k.x,r=0>k.x;x||(n&&!i?(r?(o(y-1,-E,0),o(y,w[y]-E,g),o(y+1,w[y+1]-E,g),y+=1):(o(y+1,E,0),o(y,w[y]+E,g),o(y-1,w[y-1]+E,g),y+=-1),e.callback&&e.callback(y,m[y])):(o(y-1,-E,g),o(y,0,g),o(y+1,E,g))),p.removeEventListener("touchmove",D,!1),p.removeEventListener("touchend",D,!1)},transitionEnd:function(t){parseInt(t.target.getAttribute("data-index"),10)==y&&(T&&v(),e.transitionEnd&&e.transitionEnd.call(t,y,m[y]),e.events&&e.events.emit("transitionEnd",c,y,m[y]))}};return n(),T&&v(),h.addEventListener?(h.touch&&p.addEventListener("touchstart",D,!1),h.transitions&&(p.addEventListener("webkitTransitionEnd",D,!1),p.addEventListener("msTransitionEnd",D,!1),p.addEventListener("oTransitionEnd",D,!1),p.addEventListener("otransitionend",D,!1),p.addEventListener("transitionend",D,!1)),window.addEventListener("resize",D,!1)):window.onresize=function(){n()},{setup:n,slide:s,prev:function(){u(),i()},next:function(){u(),r()},getPos:function(){return y},kill:function(){u(),p.style.width="auto",p.style.left=0;for(var t=m.length;t--;){var e=m[t];e.style.width="100%",e.style.left=0,h.transitions&&a(t,0,0)}h.addEventListener?(p.removeEventListener("touchstart",D,!1),p.removeEventListener("webkitTransitionEnd",D,!1),p.removeEventListener("msTransitionEnd",D,!1),p.removeEventListener("oTransitionEnd",D,!1),p.removeEventListener("otransitionend",D,!1),p.removeEventListener("transitionend",D,!1),window.removeEventListener("resize",D,!1)):window.onresize=null},slideCount:function(){return m.length}}}}(window.jQuery||window.Zepto)&&function(t){t.fn.Swipe=function(e){return this.each(function(){t(this).data("Swipe",new Swipe(t(this)[0],e))})}}(window.jQuery||window.Zepto);
