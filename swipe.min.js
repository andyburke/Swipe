/*
 * Swipe 2.0
 *
 * Brad Birdsall
 * Copyright 2013, MIT License
 *
*/
function Swipe(t,n){"use strict";function e(){p=b.children,g=p.length,2>p.length&&(n.continuous=!1),w.transitions&&n.continuous&&3>p.length&&(b.appendChild(p[0].cloneNode(!0)),b.appendChild(b.children[1].cloneNode(!0)),p=b.children),E=Array(p.length),x=t.getBoundingClientRect().width||t.offsetWidth,b.style.width=p.length*x+"px";for(var e=p.length;e--;){var i=p[e];i.style.width=x+"px",i.setAttribute("data-index",e),w.transitions&&(i.style.left=e*-x+"px",a(e,y>e?-x:e>y?x:0,0))}n.continuous&&w.transitions&&(a(s(y-1),-x,0),a(s(y+1),x,0)),w.transitions||(b.style.left=y*-x+"px"),t.style.visibility="visible"}function i(){n.continuous?r(y-1):y&&r(y-1),n.events&&n.events.emit("prev",f)}function o(){n.continuous?r(y+1):p.length-1>y&&r(y+1)}function s(t){return(p.length+t%p.length)%p.length}function r(t,e){var i=-1;if("number"==typeof t)i=t;else if("string"==typeof t)for(var o=0;p.length>o;++o){var r=p[o];if(r.id===t){i=o;break}}else{if(!(t instanceof Element))throw"Invalid target type.";for(var o=0;p.length>o;++o){var r=p[o];if(r.id==id){i=o;break}}}if(-1==i||i==y)return!1;if(w.transitions){var u=Math.abs(i-y)/(i-y);if(n.continuous){var c=u;u=-E[s(y)]/x,u!==c&&(y=-u*p.length+y)}for(var l=Math.abs(i-y)-1;l--;)a(s((i>y?i:y)-l-1),x*u,0);y=s(toIndexndex),a(y,x*u,e||T),a(i,0,e||T),n.continuous&&a(s(y-u),-(x*u),0)}else y=s(i),d(y*-x,i*-x,e||T);y=i,m(n.callback&&n.callback(y,p[y])),n.events&&n.events.emit("slide",f,y,p[y])}function a(t,n,e){u(t,n,e),E[t]=n}function u(t,n,e){var i=p[t],o=i&&i.style;o&&(o.webkitTransitionDuration=o.MozTransitionDuration=o.msTransitionDuration=o.OTransitionDuration=o.transitionDuration=e+"ms",o.webkitTransform="translate("+n+"px,0)"+"translateZ(0)",o.msTransform=o.MozTransform=o.OTransform="translateX("+n+"px)")}function d(t,e,i){if(!i)return b.style.left=e+"px",void 0;var o=+new Date,s=setInterval(function(){var r=+new Date-o;return r>i?(b.style.left=e+"px",D&&c(),n.transitionEnd&&n.transitionEnd.call(event,y,p[y]),n.events&&n.events.emit("transitionEnd",f,y,p[y]),clearInterval(s),void 0):(b.style.left=(e-t)*(Math.floor(100*(r/i))/100)+t+"px",void 0)},4)}function c(){L=setTimeout(o,D),n.events&&n.events.emit("begin",f)}function l(){D=0,clearTimeout(L),n.events&&n.events.emit("stop",f)}function v(){return p.length}var f=this,h=function(){},m=function(t){setTimeout(t||h,0)},w={addEventListener:!!window.addEventListener,touch:"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,transitions:function(t){var n=["transitionProperty","WebkitTransition","MozTransition","OTransition","msTransition"];for(var e in n)if(void 0!==t.style[n[e]])return!0;return!1}(document.createElement("swipe"))};if(t){var p,E,x,g,b=t.children[0];n=n||{};var y=parseInt(n.startSlide,10)||0,T=n.speed||300;n.continuous=void 0!==n.continuous?n.continuous:!0;var L,k,D=n.auto||0,M={},z={},S={handleEvent:function(t){switch(t.type){case"touchstart":this.start(t);break;case"touchmove":this.move(t);break;case"touchend":m(this.end(t));break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"otransitionend":case"transitionend":m(this.transitionEnd(t));break;case"resize":m(e.call())}n.stopPropagation&&t.stopPropagation()},start:function(t){var n=t.touches[0];M={x:n.pageX,y:n.pageY,time:+new Date},k=void 0,z={},b.addEventListener("touchmove",this,!1),b.addEventListener("touchend",this,!1)},move:function(t){if(!(t.touches.length>1||t.scale&&1!==t.scale)){n.disableScroll&&t.preventDefault();var e=t.touches[0];z={x:e.pageX-M.x,y:e.pageY-M.y},k===void 0&&(k=!!(k||Math.abs(z.x)<Math.abs(z.y))),k||(t.preventDefault(),l(),n.continuous?(u(s(y-1),z.x+E[s(y-1)],0),u(y,z.x+E[y],0),u(s(y+1),z.x+E[s(y+1)],0)):(z.x=z.x/(!y&&z.x>0||y==p.length-1&&0>z.x?Math.abs(z.x)/x+1:1),u(y-1,z.x+E[y-1],0),u(y,z.x+E[y],0),u(y+1,z.x+E[y+1],0)))}},end:function(){var t=+new Date-M.time,e=250>Number(t)&&Math.abs(z.x)>20||Math.abs(z.x)>x/2,i=!y&&z.x>0||y==p.length-1&&0>z.x;n.continuous&&(i=!1);var o=0>z.x;k||(e&&!i?(o?(n.continuous?(a(s(y-1),-x,0),a(s(y+2),x,0)):a(y-1,-x,0),a(y,E[y]-x,T),a(s(y+1),E[s(y+1)]-x,T),y=s(y+1)):(n.continuous?(a(s(y+1),x,0),a(s(y-2),-x,0)):a(y+1,x,0),a(y,E[y]+x,T),a(s(y-1),E[s(y-1)]+x,T),y=s(y-1)),n.callback&&n.callback(y,p[y])):n.continuous?(a(s(y-1),-x,T),a(y,0,T),a(s(y+1),x,T)):(a(y-1,-x,T),a(y,0,T),a(y+1,x,T))),b.removeEventListener("touchmove",S,!1),b.removeEventListener("touchend",S,!1)},transitionEnd:function(t){parseInt(t.target.getAttribute("data-index"),10)==y&&(D&&c(),n.transitionEnd&&n.transitionEnd.call(t,y,p[y]),n.events&&n.events.emit("transitionEnd",f,y,p[y]))}};return e(),D&&c(),w.addEventListener?(w.touch&&b.addEventListener("touchstart",S,!1),w.transitions&&(b.addEventListener("webkitTransitionEnd",S,!1),b.addEventListener("msTransitionEnd",S,!1),b.addEventListener("oTransitionEnd",S,!1),b.addEventListener("otransitionend",S,!1),b.addEventListener("transitionend",S,!1)),window.addEventListener("resize",S,!1)):window.onresize=function(){e()},{setup:e,slide:function(t,n){l(),r(t,n)},prev:function(){l(),i()},next:function(){l(),o()},getPos:function(){return y},getNumSlides:function(){return g},kill:function(){l(),b.style.width="auto",b.style.left=0;for(var t=p.length;t--;){var n=p[t];n.style.width="100%",n.style.left=0,w.transitions&&u(t,0,0)}w.addEventListener?(b.removeEventListener("touchstart",S,!1),b.removeEventListener("webkitTransitionEnd",S,!1),b.removeEventListener("msTransitionEnd",S,!1),b.removeEventListener("oTransitionEnd",S,!1),b.removeEventListener("otransitionend",S,!1),b.removeEventListener("transitionend",S,!1),window.removeEventListener("resize",S,!1)):window.onresize=null},slideCount:v}}}(window.jQuery||window.Zepto)&&function(t){t.fn.Swipe=function(n){return this.each(function(){t(this).data("Swipe",new Swipe(t(this)[0],n))})}}(window.jQuery||window.Zepto);
