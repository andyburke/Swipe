/*
 * Swipe 2.0
 *
 * Brad Birdsall
 * Copyright 2013, MIT License
 *
*/

function Swipe(t,e){"use strict";function n(){w=b.children,E=Array(w.length),p=t.getBoundingClientRect().width||t.offsetWidth,b.style.width=w.length*p+"px";for(var e=w.length;e--;){var n=w[e];n.style.width=p+"px",n.setAttribute("data-index",e),m.transitions&&(n.style.left=e*-p+"px",o(e,x>e?-p:e>x?p:0,0))}m.transitions||(b.style.left=x*-p+"px"),t.style.visibility="visible"}function i(){x?s(x-1):e.continuous&&s(w.length-1),e.events&&e.events.emit("prev",l)}function r(){w.length-1>x?s(x+1):e.continuous&&s(0),e.events&&e.events.emit("next",l)}function s(t,n){var i=-1;if("number"==typeof t)i=t;else if("string"==typeof t)for(var r=0;w.length>r;++r){var s=w[r];if(s.id===t){i=r;break}}else{if(!(t instanceof Element))throw"Invalid target type.";for(var r=0;w.length>r;++r){var s=w[r];if(s.id==id){i=r;break}}}if(-1==i||i==x)return!1;if(m.transitions){for(var a=Math.abs(x-i)-1,u=Math.abs(x-i)/(x-i);a--;)o((i>x?i:x)-a-1,p*u,0);o(x,p*u,n||g),o(i,0,n||g)}else d(x*-p,i*-p,n||g);return x=i,h(e.callback&&e.callback(x,w[x])),e.events&&e.events.emit("slide",l,x,w[x]),!0}function o(t,e,n){a(t,e,n),E[t]=e}function a(t,e,n){var i=w[t],r=i&&i.style;r&&(r.webkitTransitionDuration=r.MozTransitionDuration=r.msTransitionDuration=r.OTransitionDuration=r.transitionDuration=n+"ms",r.webkitTransform="translate("+e+"px,0)"+"translateZ(0)",r.msTransform=r.MozTransform=r.OTransform="translateX("+e+"px)")}function d(t,n,i){if(!i)return b.style.left=n+"px",void 0;var r=+new Date,s=setInterval(function(){var o=+new Date-r;return o>i?(b.style.left=n+"px",L&&u(),e.transitionEnd&&e.transitionEnd.call(event,x,w[x]),e.events&&e.events.emit("transitionEnd",l,x,w[x]),clearInterval(s),void 0):(b.style.left=(n-t)*(Math.floor(100*(o/i))/100)+t+"px",void 0)},4)}function u(){y=setTimeout(r,L),e.events&&e.events.emit("begin",l)}function v(){L=0,clearTimeout(y),e.events&&e.events.emit("stop",l)}function c(){return w.length}var l=this,f=function(){},h=function(t){setTimeout(t||f,0)},m={addEventListener:!!window.addEventListener,touch:"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch,transitions:function(t){var e=["transformProperty","WebkitTransform","MozTransform","OTransform","msTransform"];for(var n in e)if(void 0!==t.style[e[n]])return!0;return!1}(document.createElement("swipe"))};if(t){var w,E,p,b=t.children[0];e=e||{};var x=parseInt(e.startSlide,10)||0,g=e.speed||300;e.continuous=void 0!==e.continuous?e.continuous:!0;var y,T,L=e.auto||0,k={},D={},M={handleEvent:function(t){switch(t.type){case"touchstart":this.start(t);break;case"touchmove":this.move(t);break;case"touchend":h(this.end(t));break;case"webkitTransitionEnd":case"msTransitionEnd":case"oTransitionEnd":case"otransitionend":case"transitionend":h(this.transitionEnd(t));break;case"resize":h(n.call())}e.stopPropagation&&t.stopPropagation()},start:function(t){var e=t.touches[0];k={x:e.pageX,y:e.pageY,time:+new Date},T=void 0,D={},b.addEventListener("touchmove",this,!1),b.addEventListener("touchend",this,!1)},move:function(t){if(!(t.touches.length>1||t.scale&&1!==t.scale)){e.disableScroll&&t.preventDefault();var n=t.touches[0];D={x:n.pageX-k.x,y:n.pageY-k.y},T===void 0&&(T=!!(T||Math.abs(D.x)<Math.abs(D.y))),T||(t.preventDefault(),v(),D.x=D.x/(!x&&D.x>0||x==w.length-1&&0>D.x?Math.abs(D.x)/p+1:1),a(x-1,D.x+E[x-1],0),a(x,D.x+E[x],0),a(x+1,D.x+E[x+1],0))}},end:function(){var t=+new Date-k.time,n=250>Number(t)&&Math.abs(D.x)>20||Math.abs(D.x)>p/2,i=!x&&D.x>0||x==w.length-1&&0>D.x,r=0>D.x;T||(n&&!i?(r?(o(x-1,-p,0),o(x,E[x]-p,g),o(x+1,E[x+1]-p,g),x+=1):(o(x+1,p,0),o(x,E[x]+p,g),o(x-1,E[x-1]+p,g),x+=-1),e.callback&&e.callback(x,w[x]),e.events&&e.events.emit("slide",l,x,w[x])):(o(x-1,-p,g),o(x,0,g),o(x+1,p,g))),b.removeEventListener("touchmove",M,!1),b.removeEventListener("touchend",M,!1)},transitionEnd:function(t){parseInt(t.target.getAttribute("data-index"),10)==x&&(L&&u(),e.transitionEnd&&e.transitionEnd.call(t,x,w[x]),e.events&&e.events.emit("transitionEnd",l,x,w[x]))}};return n(),L&&u(),m.addEventListener?(m.touch&&b.addEventListener("touchstart",M,!1),m.transitions&&(b.addEventListener("webkitTransitionEnd",M,!1),b.addEventListener("msTransitionEnd",M,!1),b.addEventListener("oTransitionEnd",M,!1),b.addEventListener("otransitionend",M,!1),b.addEventListener("transitionend",M,!1)),window.addEventListener("resize",M,!1)):window.onresize=function(){n()},{setup:n,slide:function(t,e){v(),s(t,e)},prev:function(){v(),i()},next:function(){v(),r()},getPos:function(){return x},getNumSlides:function(){return w.length},kill:function(){v(),b.style.width="auto",b.style.left=0;for(var t=w.length;t--;){var e=w[t];e.style.width="100%",e.style.left=0,m.transitions&&a(t,0,0)}m.addEventListener?(b.removeEventListener("touchstart",M,!1),b.removeEventListener("webkitTransitionEnd",M,!1),b.removeEventListener("msTransitionEnd",M,!1),b.removeEventListener("oTransitionEnd",M,!1),b.removeEventListener("otransitionend",M,!1),b.removeEventListener("transitionend",M,!1),window.removeEventListener("resize",M,!1)):window.onresize=null},slideCount:c}}}(window.jQuery||window.Zepto)&&function(t){t.fn.Swipe=function(e){return this.each(function(){t(this).data("Swipe",new Swipe(t(this)[0],e))})}}(window.jQuery||window.Zepto);
